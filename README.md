# åŸºäºŽé€»è¾‘å›žå½’çš„ä»·æ ¼è¶‹åŠ¿é¢„æµ‹æ¨¡åž‹

æœ¬é¡¹ç›®æ—¨åœ¨åˆ©ç”¨OKXæä¾›çš„5å¹´æœŸã€å¤šæ—¶é—´é¢‘çŽ‡ï¼ˆ1D, 1H, 15mï¼‰çš„Kçº¿æ•°æ®ï¼Œæž„å»ºä¸€ä¸ªæœºå™¨å­¦ä¹ æ¨¡åž‹ï¼Œä»¥é¢„æµ‹ETHï¼ˆä»¥å¤ªåŠï¼‰å’ŒBTCï¼ˆæ¯”ç‰¹å¸ï¼‰åœ¨æœªæ¥ç‰¹å®šæ—¶é—´çª—å£ï¼ˆ15/30/60åˆ†é’Ÿï¼‰å†…çš„ä»·æ ¼æ–¹å‘ï¼ˆä¸Šæ¶¨/ä¸‹è·Œï¼‰ã€‚

å½“å‰ç‰ˆæœ¬ä½¿ç”¨**é€»è¾‘å›žå½’ (Logistic Regression)** ä½œä¸ºåŸºçº¿æ¨¡åž‹ã€‚

> **å¤‡æ³¨**: æ‚¨åœ¨æé—®æ—¶å¯èƒ½ä½¿ç”¨äº†"çº¿æ€§å›žå½’"ï¼Œä½†ç”±äºŽæˆ‘ä»¬çš„ç›®æ ‡æ˜¯é¢„æµ‹"æ¶¨/è·Œ"æ–¹å‘ï¼ˆä¸€ä¸ªåˆ†ç±»é—®é¢˜ï¼‰ï¼Œå› æ­¤åœ¨å®žé™…æ‰§è¡Œä¸­æˆ‘ä»¬é‡‡ç”¨äº†æ›´é€‚åˆæ­¤ä»»åŠ¡çš„"é€»è¾‘å›žå½’"æ¨¡åž‹ã€‚

## é¡¹ç›®ç»“æž„

```
price_trend_attention_model/
â”œâ”€â”€ configs/          # é…ç½®æ–‡ä»¶ (æš‚æœªä½¿ç”¨)
â”œâ”€â”€ data/             # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ raw/          # åŽŸå§‹ä¸‹è½½æ•°æ®
â”‚   â”œâ”€â”€ processed/    # é¢„å¤„ç†åŽæ•°æ® (æš‚æœªä½¿ç”¨)
â”‚   â””â”€â”€ featured/     # ç‰¹å¾å·¥ç¨‹åŽæ•°æ®
â”œâ”€â”€ logs/             # æ—¥å¿—ã€æ¨¡åž‹è¯„ä¼°æŠ¥å‘Šã€æ··æ·†çŸ©é˜µå›¾
â”œâ”€â”€ models/           # ä¿å­˜çš„å·²è®­ç»ƒæ¨¡åž‹
â”œâ”€â”€ notebooks/        # Jupyter Notebooks (æŽ¢ç´¢æ€§åˆ†æž)
â”œâ”€â”€ scripts/          # ä¸»è¦æ‰§è¡Œè„šæœ¬
â”‚   â”œâ”€â”€ download_history_mark_price.py # æ•°æ®ä¸‹è½½
â”‚   â”œâ”€â”€ advanced_feature_engineering.py# ç‰¹å¾å·¥ç¨‹
â”‚   â”œâ”€â”€ train_logistic_regression.py   # æ¨¡åž‹è®­ç»ƒ
â”‚   â””â”€â”€ predict.py                     # æ¨¡åž‹é¢„æµ‹
â”œâ”€â”€ pyproject.toml    # é¡¹ç›®ä¾èµ–
â”œâ”€â”€ uv.lock           # ä¾èµ–é”å®šæ–‡ä»¶
â””â”€â”€ README.md         # æœ¬æ–‡æ¡£
```

## å·¥ä½œæµï¼šå¦‚ä½•å¤çŽ° (ä»¥ETHä¸ºä¾‹)

è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ¥å®Œæˆä»Žæ•°æ®ä¸‹è½½åˆ°æ¨¡åž‹é¢„æµ‹çš„å…¨è¿‡ç¨‹ã€‚

### æ­¥éª¤ 0: çŽ¯å¢ƒè®¾ç½®

æœ¬é¡¹ç›®ä½¿ç”¨ `uv` ä½œä¸ºåŒ…ç®¡ç†å™¨ã€‚é¦–å…ˆï¼Œè¯·åŒæ­¥ä¾èµ–çŽ¯å¢ƒï¼š

```bash
uv sync
```

### æ­¥éª¤ 1: ä¸‹è½½æ•°æ®

è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥ä¸‹è½½ `ETH-USD-SWAP` çš„5å¹´åŽ†å²Kçº¿æ•°æ®ã€‚æ•°æ®ä¼šä¿å­˜åœ¨ `data/raw/` ç›®å½•ä¸‹ã€‚

```bash
uv run python3 scripts/download_history_mark_price.py --instId ETH-USD-SWAP
```

*è„šæœ¬ä¼šè‡ªåŠ¨ä¸‹è½½ 1D, 1H, 15m ä¸‰ç§æ—¶é—´é¢‘çŽ‡çš„æ•°æ®ã€‚*

### æ­¥éª¤ 2: ç‰¹å¾å·¥ç¨‹

è¿è¡Œé«˜çº§ç‰¹å¾å·¥ç¨‹è„šæœ¬ã€‚å®ƒä¼šåŠ è½½åŽŸå§‹æ•°æ®ï¼Œè®¡ç®—å„ç§æŠ€æœ¯æŒ‡æ ‡å’Œç»Ÿè®¡ç‰¹å¾ï¼Œä½¿ç”¨VIFè¿›è¡Œç‰¹å¾é€‰æ‹©ï¼Œå¹¶å°†æœ€ç»ˆçš„ç‰¹å¾æ•°æ®é›†ä¿å­˜åœ¨ `data/featured/` ç›®å½•ä¸‹ã€‚

```bash
uv run python3 scripts/advanced_feature_engineering.py
```
*è¯¥è„šæœ¬ä¼šåŒæ—¶å¤„ç† `BTC` å’Œ `ETH` çš„æ•°æ®ã€‚*

### æ­¥éª¤ 3: è®­ç»ƒæ¨¡åž‹

çŽ°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è®­ç»ƒé€»è¾‘å›žå½’æ¨¡åž‹ã€‚ä½ éœ€è¦æŒ‡å®š `--instId` (èµ„äº§) å’Œ `--horizon` (é¢„æµ‹çª—å£)ã€‚

*   `--horizon 1`: é¢„æµ‹æœªæ¥1ä¸ª15åˆ†é’ŸKçº¿
*   `--horizon 2`: é¢„æµ‹æœªæ¥2ä¸ª15åˆ†é’ŸKçº¿ (30åˆ†é’Ÿ)
*   `--horizon 4`: é¢„æµ‹æœªæ¥4ä¸ª15åˆ†é’ŸKçº¿ (60åˆ†é’Ÿ)

ä¾‹å¦‚ï¼Œè®­ç»ƒä¸€ä¸ªç”¨äºŽé¢„æµ‹ETHæœªæ¥15åˆ†é’Ÿæ–¹å‘çš„æ¨¡åž‹ï¼š

```bash
uv run python3 scripts/train_logistic_regression.py --instId ETH-USD-SWAP --horizon 1
```

è®­ç»ƒå®ŒæˆåŽï¼Œæ¨¡åž‹å°†ä¿å­˜åœ¨ `models/` ç›®å½•ï¼Œè€Œè¯¦ç»†çš„è¯„ä¼°æŠ¥å‘Šå’Œæ··æ·†çŸ©é˜µå›¾å°†ä¿å­˜åœ¨ `logs/` ç›®å½•ã€‚

### æ­¥éª¤ 4: ä½¿ç”¨æ¨¡åž‹è¿›è¡Œé¢„æµ‹

ä½¿ç”¨ `predict.py` è„šæœ¬å’Œä½ åˆšåˆšè®­ç»ƒå¥½çš„æ¨¡åž‹æ¥è¿›è¡Œé¢„æµ‹ã€‚è¯¥è„šæœ¬ä¼šè‡ªåŠ¨åŠ è½½ä¸Žä½ æŒ‡å®šçš„èµ„äº§å’Œè§†ç•Œç›¸åŒ¹é…çš„**æœ€æ–°**æ¨¡åž‹ï¼Œå¹¶å¯¹**æœ€æ–°**çš„ä¸€æ¡Kçº¿æ•°æ®è¿›è¡Œé¢„æµ‹ã€‚

ä¾‹å¦‚ï¼Œä½¿ç”¨åˆšè®­ç»ƒçš„ETHæ¨¡åž‹è¿›è¡Œé¢„æµ‹ï¼š

```bash
uv run python3 scripts/predict.py --instId ETH-USD_SWAP --horizon 1
```

ä½ å°†ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼š

```
INFO: ======================================================================
INFO: ðŸš€ å¼€å§‹ä¸ºèµ„äº§ ETH-USD-SWAP åœ¨è§†ç•Œ h1 ä¸Šè¿›è¡Œé¢„æµ‹...
INFO: Step 1: æ­£åœ¨æŸ¥æ‰¾å¹¶åŠ è½½æœ€æ–°æ¨¡åž‹...
INFO: âœ… æˆåŠŸåŠ è½½æ¨¡åž‹: ETH-USD-SWAP_h1_logistic_regression_YYYYMMDD_HHMMSS.joblib
INFO: Step 2: æ­£åœ¨åŠ è½½ç‰¹å¾æ•°æ®...
INFO: Step 3: å‡†å¤‡æœ€æ–°çš„æ•°æ®ç‚¹è¿›è¡Œé¢„æµ‹...
INFO:   é¢„æµ‹æ‰€åŸºäºŽçš„æœ€æ–°Kçº¿æ—¶é—´ç‚¹: 2024-XX-XX XX:XX:XX
INFO: Step 4: æ‰§è¡Œé¢„æµ‹...
INFO: 
============================ é¢„æµ‹ç»“æžœ ============================
INFO:   èµ„äº§: ETH-USD-SWAP
INFO:   é¢„æµ‹æ—¶é—´: 2024-XX-XX XX:XX:XX
INFO:   é¢„æµ‹åŸºå‡†Kçº¿: 2024-XX-XX XX:XX:XX
INFO:   é¢„æµ‹æœªæ¥çª—å£: 15 åˆ†é’ŸåŽ
INFO:   é¢„æµ‹æ–¹å‘: çœ‹æ¶¨ (UP)
INFO:   çœ‹æ¶¨ç½®ä¿¡åº¦: 65.73%
INFO:   çœ‹è·Œç½®ä¿¡åº¦: 34.27%
INFO: ======================================================================
```

## å…³äºŽæµ‹è¯•é›†çš„è¯´æ˜Ž

ä¸ºäº†ç¡®ä¿æ¨¡åž‹è¯„ä¼°çš„å…¬æ­£æ€§å’Œæœ‰æ•ˆæ€§ï¼Œæœ¬é¡¹ç›®é‡‡ç”¨ä¸¥æ ¼çš„**æ—¶é—´åºåˆ—åˆ†å‰²**æ–¹æ³•æ¥åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†ã€‚

*   **æ•°æ®é›†æ¥æº**: `data/featured/` ä¸­çš„ç‰¹å¾æ•°æ®ï¼Œå·²æŒ‰æ—¶é—´ä»Žæ—§åˆ°æ–°æŽ’åºã€‚
*   **è®­ç»ƒé›† (Training Set)**: ä½¿ç”¨æ•°æ®é›†ä¸­**å‰80%** çš„è¿žç»­æ•°æ®ã€‚
*   **æµ‹è¯•é›† (Test Set)**: ä½¿ç”¨æ•°æ®é›†ä¸­**åŽ20%** çš„è¿žç»­æ•°æ®ã€‚

è¿™ç§æ–¹æ³•ä¿è¯äº†æ¨¡åž‹åªåœ¨"è¿‡åŽ»"çš„æ•°æ®ä¸Šè®­ç»ƒï¼Œå¹¶åœ¨"æœªæ¥"çš„ã€å®Œå…¨æœªè§è¿‡çš„æ•°æ®ä¸Šè¿›è¡Œæµ‹è¯•ï¼Œè¿™å¯¹äºŽè¯„ä¼°é‡‘èžé¢„æµ‹æ¨¡åž‹è‡³å…³é‡è¦ã€‚

## ç‰¹å¾å·¥ç¨‹è¯¦è§£ (Feature Formulas)

ä»¥ä¸‹æ˜¯åœ¨ `advanced_feature_engineering.py` è„šæœ¬ä¸­ç”Ÿæˆçš„æ ¸å¿ƒç‰¹å¾åŠå…¶è®¡ç®—å…¬å¼ã€‚

### 1. ç›®æ ‡å˜é‡ (Target Variable)

- **Mid-price-2**: `(high + low) / 2`
    - è¿™æ˜¯æˆ‘ä»¬ç”¨æ¥åˆ¤æ–­æœªæ¥ä»·æ ¼æ–¹å‘çš„åŸºç¡€ã€‚
- **Label_h (é¢„æµ‹æ ‡ç­¾)**: `(Mid-price-2.shift(-h) > Mid-price-2).astype(int)`
    - å¦‚æžœæœªæ¥ç¬¬ `h` ä¸ªæ—¶é—´ç‚¹çš„ `Mid-price-2` é«˜äºŽå½“å‰ï¼Œæ ‡ç­¾ä¸º1 (çœ‹æ¶¨)ï¼Œå¦åˆ™ä¸º0 (çœ‹è·Œ)ã€‚

### 2. OHLC è¡ç”Ÿç‰¹å¾

- **Range**: `high - low`
- **Body**: `abs(close - open)`
- **Upper_Wick**: `high - max(open, close)`
- **Lower_Wick**: `min(open, close) - low`

### 3. æŠ€æœ¯æŒ‡æ ‡ (Technical Indicators)

- **SMA_N (ç®€å•ç§»åŠ¨å¹³å‡)**: `close.rolling(window=N).mean()`
- **EMA_N (æŒ‡æ•°ç§»åŠ¨å¹³å‡)**: `close.ewm(span=N, adjust=False).mean()`
- **RSI_14 (ç›¸å¯¹å¼ºå¼±æŒ‡æ•°)**:
    - `delta = close.diff()`
    - `gain = (delta.where(delta > 0, 0)).ewm(alpha=1/14).mean()`
    - `loss = (-delta.where(delta < 0, 0)).ewm(alpha=1/14).mean()`
    - `rs = gain / loss`
    - `RSI_14 = 100 - (100 / (1 + rs))`
- **MACD (ç§»åŠ¨å¹³å‡æ”¶æ•›æ•£åº¦)**:
    - `MACD_line = EMA(close, 12) - EMA(close, 26)`
    - `Signal_line = EMA(MACD_line, 9)`
    - `MACD_hist = MACD_line - Signal_line`
- **Bollinger Bands (å¸ƒæž—å¸¦)**:
    - `Middle_Band = SMA(close, 20)`
    - `Upper_Band = Middle_Band + 2 * close.rolling(20).std()`
    - `Lower_Band = Middle_Band - 2 * close.rolling(20).std()`
- **ATRr_14 (å¹³å‡çœŸå®žæ³¢å¹…)**:
    - `tr = max(high - low, abs(high - close.shift()), abs(low - close.shift()))`
    - `ATRr_14 = EMA(tr, 14)`
- **MOM_10 (åŠ¨é‡)**: `close.diff(10)`

### 4. é«˜çº§ç»Ÿè®¡ç‰¹å¾

- **Log_Return (å¯¹æ•°æ”¶ç›ŠçŽ‡)**: `log(close / close.shift(1))`
- **RV (å·²å®žçŽ°æ³¢åŠ¨çŽ‡)**: `Log_Return.rolling(window=20).std() * sqrt(20)`
- **Parkinson_Vol (å¸•é‡‘æ£®æ³¢åŠ¨çŽ‡)**: `sqrt(0.5 * log(high / low)^2).rolling(window=20).mean()`
- **Skewness (ååº¦)**: `Log_Return.rolling(window=60).skew()`
- **Kurtosis (å³°åº¦)**: `Log_Return.rolling(window=60).kurt()`

### 5. å¤šé¢‘çŽ‡èžåˆç‰¹å¾ (ä»¥15åˆ†é’Ÿæ•°æ®ä¸ºæ ¸å¿ƒ)

- **MidPrice2_vs_1h (ç›¸å¯¹1å°æ—¶ä¸­é—´ä»·)**: `(MidPrice2_15m - MidPrice2_1h) / MidPrice2_1h`
- **MidPrice2_vs_1d (ç›¸å¯¹1å¤©ä¸­é—´ä»·)**: `(MidPrice2_15m - MidPrice2_1d) / MidPrice2_1d`
- **RSI_15min_vs_1h (ç›¸å¯¹1å°æ—¶RSI)**: `RSI_15m - RSI_1h`
- **RSI_15min_vs_1d (ç›¸å¯¹1å¤©RSI)**: `RSI_15m - RSI_1d`
